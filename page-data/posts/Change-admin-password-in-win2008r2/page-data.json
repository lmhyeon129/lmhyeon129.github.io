{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/Change-admin-password-in-win2008r2/","result":{"data":{"markdownRemark":{"id":"539e37f6-e32b-5445-8682-464b5d94e144","html":"<h2 id=\"change-admin-password-in-windows-server-2008-r2\"><a href=\"#change-admin-password-in-windows-server-2008-r2\" aria-label=\"change admin password in windows server 2008 r2 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Change admin password in Windows Server 2008 R2</h2>\n<p>주기적으로 서버의 admin password를 변경해야 할 일이 있을 때 적용 가능한 스크립트 입니다.</p>\n<h4 id=\"이-스크립트가-변경-가능한-항목은-다음과-같습니다\"><a href=\"#%EC%9D%B4-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EA%B0%80-%EB%B3%80%EA%B2%BD-%EA%B0%80%EB%8A%A5%ED%95%9C-%ED%95%AD%EB%AA%A9%EC%9D%80-%EB%8B%A4%EC%9D%8C%EA%B3%BC-%EA%B0%99%EC%8A%B5%EB%8B%88%EB%8B%A4\" aria-label=\"이 스크립트가 변경 가능한 항목은 다음과 같습니다 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이 스크립트가 변경 가능한 항목은 다음과 같습니다.</h4>\n<ul>\n<li>서비스의 시작 계정</li>\n<li>Application pool 의 프로세스 시작 계정</li>\n<li>Web site 의 디렉토리 접근 계정</li>\n<li>Web application 의 디렉토리 접근 계정</li>\n<li>Virtual directory 의 디렉토리 접근 계정</li>\n<li>*.config 파일에 저장된 비밀번호</li>\n</ul>\n<blockquote>\n<p>config 파일은 따로 목록을 정리하여 csv 파일로 스크립트에 제공합니다.\nconfig 비밀번호 변경 시 비밀번호에 $<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>가들어가는경우에는</mtext></mrow><annotation encoding=\"application/x-tex\">가 들어가는 경우에는</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord hangul_fallback\">가</span><span class=\"mord hangul_fallback\">들</span><span class=\"mord hangul_fallback\">어</span><span class=\"mord hangul_fallback\">가</span><span class=\"mord hangul_fallback\">는</span><span class=\"mord hangul_fallback\">경</span><span class=\"mord hangul_fallback\">우</span><span class=\"mord hangul_fallback\">에</span><span class=\"mord hangul_fallback\">는</span></span></span></span>로 치환이 됩니다.\n따라서, <code class=\"language-text\">$$</code> 를 넣고 싶은 경우에는 <code class=\"language-text\">$$$</code> 로 넣어 주어야 합니다.</p>\n</blockquote>\n<h4 id=\"config-파일-목록은-다음과-같은-형식으로-저장됩니다\"><a href=\"#config-%ED%8C%8C%EC%9D%BC-%EB%AA%A9%EB%A1%9D%EC%9D%80-%EB%8B%A4%EC%9D%8C%EA%B3%BC-%EA%B0%99%EC%9D%80-%ED%98%95%EC%8B%9D%EC%9C%BC%EB%A1%9C-%EC%A0%80%EC%9E%A5%EB%90%A9%EB%8B%88%EB%8B%A4\" aria-label=\"config 파일 목록은 다음과 같은 형식으로 저장됩니다 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>config 파일 목록은 다음과 같은 형식으로 저장됩니다.</h4>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">> <span class=\"token function\">Get-Content</span> <span class=\"token punctuation\">.</span>\\configList<span class=\"token punctuation\">.</span>csv\nhostname<span class=\"token punctuation\">,</span>filePath\nHOSTNAME<span class=\"token punctuation\">,</span>C:\\webroot\\web<span class=\"token punctuation\">.</span>config</code></pre></div>\n<h4 id=\"스크립트가-변경하지-못하는-항목은-다음과-같습니다\"><a href=\"#%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EA%B0%80-%EB%B3%80%EA%B2%BD%ED%95%98%EC%A7%80-%EB%AA%BB%ED%95%98%EB%8A%94-%ED%95%AD%EB%AA%A9%EC%9D%80-%EB%8B%A4%EC%9D%8C%EA%B3%BC-%EA%B0%99%EC%8A%B5%EB%8B%88%EB%8B%A4\" aria-label=\"스크립트가 변경하지 못하는 항목은 다음과 같습니다 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스크립트가 변경하지 못하는 항목은 다음과 같습니다.</h4>\n<ul>\n<li>configList에 없는 config 파일의 비밀번호</li>\n<li>작업 스케줄러 일부(GUI로 작성한 일부 작업 스케줄러의 경우 [매개 변수가 틀립니다] 오류가 발생)</li>\n<li>원격 서버 설정 변경</li>\n</ul>\n<h4 id=\"스크립트를-실행하고-나면-config-파일을-제외하고-적용된-항목을-csv-파일로-저장합니다\"><a href=\"#%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EB%A5%BC-%EC%8B%A4%ED%96%89%ED%95%98%EA%B3%A0-%EB%82%98%EB%A9%B4-config-%ED%8C%8C%EC%9D%BC%EC%9D%84-%EC%A0%9C%EC%99%B8%ED%95%98%EA%B3%A0-%EC%A0%81%EC%9A%A9%EB%90%9C-%ED%95%AD%EB%AA%A9%EC%9D%84-csv-%ED%8C%8C%EC%9D%BC%EB%A1%9C-%EC%A0%80%EC%9E%A5%ED%95%A9%EB%8B%88%EB%8B%A4\" aria-label=\"스크립트를 실행하고 나면 config 파일을 제외하고 적용된 항목을 csv 파일로 저장합니다 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스크립트를 실행하고 나면 config 파일을 제외하고 적용된 항목을 csv 파일로 저장합니다.</h4>\n<p>저장되는 항목은 다음과 같습니다.</p>\n<ol>\n<li><strong>id</strong>: 비밀번호 변경한 id</li>\n<li><strong>name</strong>: 대상의 이름</li>\n<li><strong>hostname</strong> </li>\n<li><strong>type</strong>: WinService, Scheduled Task, Application Pool,  Web Site, Web Appplication, Virtual Directory 중 하나</li>\n<li><strong>status</strong>: Started / Running / Stopped</li>\n</ol>\n<h4 id=\"전체-소스는-다음과-같습니다\"><a href=\"#%EC%A0%84%EC%B2%B4-%EC%86%8C%EC%8A%A4%EB%8A%94-%EB%8B%A4%EC%9D%8C%EA%B3%BC-%EA%B0%99%EC%8A%B5%EB%8B%88%EB%8B%A4\" aria-label=\"전체 소스는 다음과 같습니다 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>전체 소스는 다음과 같습니다.</h4>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\">## powershell v2.0 에서는 foreach 대상이 되는 배열이 null이더라도 한번 실행이 되는 현상이 있음...</span>\n<span class=\"token comment\">## foreach 실행 전에 if($arr -ne $NULL) 이런식으로 null 체크를 해야한다</span>\n\n<span class=\"token comment\">## string 저장할때 \"\"(double quota)로 저장하면 $$ 가 변수 이름으로 치환됨</span>\n<span class=\"token comment\">## ''(single quota)로 저장</span>\n<span class=\"token comment\">## 비밀번호 변경 시 escape가 될 가능성을 다시 확인할 필요 있음</span>\n\n<span class=\"token comment\"># id 정규표현식으로 찾을 때 id가 흔한 패턴인 경우 정규표현식의 상세화를 해 주거나, 앞뒤의 .*를 제거</span>\n<span class=\"token comment\"># id : serviceAdmin pw : Ehdhgodud0!@# 의 경우</span>\n<span class=\"token variable\">$idRegex</span> = <span class=\"token string\">'.*(serivceAdmin).*'</span>\n<span class=\"token variable\">$pwBeforeRegex</span> = <span class=\"token string\">'이전비밀번호'</span>\n<span class=\"token variable\">$id</span> = <span class=\"token string\">'domain\\serivceAdmin'</span>\n<span class=\"token variable\">$pw</span> = <span class=\"token string\">'변경할비밀번호'</span>\n\n<span class=\"token comment\">## 서버 서비스 목록</span>\n<span class=\"token variable\">$services</span> = <span class=\"token function\">Get-WMIObject</span> win32_service <span class=\"token punctuation\">|</span> where <span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>StartName <span class=\"token operator\">-Match</span> <span class=\"token variable\">$idRegex</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">## 작업 스케줄러 목록(작업 스케줄러는 운영체제 언어가 한글인 경우 멤버 프로퍼티들이 한글이름으로 나옴)</span>\n<span class=\"token variable\">$schds</span> = schtasks <span class=\"token operator\">/</span>Query <span class=\"token operator\">/</span>V <span class=\"token operator\">/</span>FO CSV <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertFrom-Csv</span> <span class=\"token punctuation\">|</span> Where <span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"다음 사용자 이름으로 실행\"</span> <span class=\"token operator\">-Match</span> <span class=\"token variable\">$idRegex</span> <span class=\"token operator\">-or</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"Run As User\"</span> <span class=\"token operator\">-Match</span> <span class=\"token variable\">$idRegex</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">## Application Pool 목록</span>\n<span class=\"token comment\">## IIS 쪽 작업을 위해서는 아래 모듈을 등록해야함</span>\n<span class=\"token function\">Import-Module</span> WebAdministration\n<span class=\"token variable\">$pools</span> = <span class=\"token function\">Get-ChildItem</span> <span class=\"token operator\">-</span>Path IIS:\\AppPools <span class=\"token punctuation\">|</span> Where <span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>processModel<span class=\"token punctuation\">.</span>userName <span class=\"token operator\">-Match</span> <span class=\"token variable\">$idRegex</span><span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\">## Web Site 목록</span>\n<span class=\"token variable\">$sites</span> = Get<span class=\"token operator\">-</span>Website <span class=\"token punctuation\">|</span> Where <span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>userName <span class=\"token operator\">-Match</span> <span class=\"token variable\">$idRegex</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">## Web Applcation 목록 (Collection[n].userName , password)</span>\n<span class=\"token comment\">## Collection[0] = web Application root</span>\n<span class=\"token variable\">$applications</span> = Get<span class=\"token operator\">-</span>WebApplication <span class=\"token punctuation\">|</span> Where <span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>Collection<span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>userName <span class=\"token operator\">-Match</span> <span class=\"token variable\">$idRegex</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">## Virtual Directory 목록</span>\n<span class=\"token variable\">$virtualDirs</span> = Get<span class=\"token operator\">-</span>WebVirtualDirectory <span class=\"token punctuation\">|</span> where <span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>userName <span class=\"token operator\">-Match</span> <span class=\"token variable\">$idRegex</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">## 위에서 조회한 목록을 엑셀로 추출</span>\n<span class=\"token variable\">$hostname</span> = hostname\n<span class=\"token variable\">$export</span> = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$services</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$item</span> in <span class=\"token variable\">$services</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> = <span class=\"token function\">new-Object</span> PSObject <span class=\"token operator\">-</span>Property @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"WinService\"</span>\n            hostname = <span class=\"token variable\">$hostname</span>\n            name = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>DisplayName\n            id = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>StartName\n            status = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>State\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token variable\">$export</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$element</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$schds</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$item</span> in <span class=\"token variable\">$schds</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> = <span class=\"token function\">new-Object</span> PSObject <span class=\"token operator\">-</span>Property @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"Scheduled Task\"</span>\n            hostname = <span class=\"token variable\">$hostname</span>\n            name = <span class=\"token string\">\"\"</span>\n            id = <span class=\"token string\">\"\"</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"작업 이름\"</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$element</span><span class=\"token punctuation\">.</span>name = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"작업 이름\"</span>\n            <span class=\"token variable\">$element</span><span class=\"token punctuation\">.</span>id = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"다음 사용자 이름으로 실행\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$element</span><span class=\"token punctuation\">.</span>name = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>TaskName\n            <span class=\"token variable\">$element</span><span class=\"token punctuation\">.</span>id = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"Run As User\"</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token variable\">$export</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$element</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pools</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$item</span> in <span class=\"token variable\">$pools</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> = <span class=\"token function\">new-Object</span> PSObject <span class=\"token operator\">-</span>Property @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"Application Pool\"</span>\n            hostname = <span class=\"token variable\">$hostname</span>\n            name = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>name\n            id = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>processModel<span class=\"token punctuation\">.</span>userName\n            status = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>State\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token variable\">$export</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$element</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sites</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$item</span> in <span class=\"token variable\">$sites</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> = <span class=\"token function\">new-Object</span> PSObject <span class=\"token operator\">-</span>Property @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"Web Site\"</span>\n            hostname = <span class=\"token variable\">$hostname</span>\n            name = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>name\n            id = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>userName\n            status = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>State\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token variable\">$export</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$element</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$applications</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$item</span> in <span class=\"token variable\">$applications</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> = <span class=\"token function\">new-Object</span> PSObject <span class=\"token operator\">-</span>Property @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"Web Application\"</span>\n            hostname = <span class=\"token variable\">$hostname</span>\n            name = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>path\n            id = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>Collection<span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>userName\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token variable\">$export</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$element</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$virtualDirs</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$item</span> in <span class=\"token variable\">$virtualDirs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> = <span class=\"token function\">new-Object</span> PSObject <span class=\"token operator\">-</span>Property @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"Virtual Directory\"</span>\n            hostname = <span class=\"token variable\">$hostname</span>\n            name = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>path\n            id = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>userName\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token variable\">$export</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$element</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token variable\">$export</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Export-Csv</span> <span class=\"token variable\">$hostname</span><span class=\"token string\">'.csv'</span> <span class=\"token operator\">-</span>Encoding UTF8\n<span class=\"token comment\">#######################################################</span>\n\n<span class=\"token comment\">## 비밀번호 재설정</span>\n\n<span class=\"token comment\">## Config file 비밀번호 변경 - 미리 준비한 list에 있는 비밀번호를 변경</span>\n<span class=\"token variable\">$configList</span> = <span class=\"token function\">Import-Csv</span> <span class=\"token string\">'.\\configList.csv'</span>\n<span class=\"token variable\">$todayString</span> = <span class=\"token function\">Get-Date</span> <span class=\"token operator\">-</span>Format yyyyMMdd\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$configList</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$item</span> in <span class=\"token variable\">$configList</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">-eq</span> <span class=\"token variable\">$hostname</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$configFilePath</span> = <span class=\"token variable\">$item</span><span class=\"token punctuation\">.</span>filePath\n            <span class=\"token function\">Copy-Item</span> <span class=\"token variable\">$configFilePath</span> <span class=\"token operator\">-</span>Destination <span class=\"token variable\">$configFilePath</span><span class=\"token string\">\".\"</span><span class=\"token variable\">$todayString</span><span class=\"token string\">\".bak\"</span>\n            <span class=\"token variable\">$fileContent</span> = <span class=\"token function\">Get-Content</span> <span class=\"token variable\">$configFilePath</span>\n            <span class=\"token variable\">$fileContent</span> <span class=\"token operator\">-Replace</span> <span class=\"token variable\">$pwBeforeRegex</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pw</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Set-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$configFilePath</span> <span class=\"token operator\">-</span>Encoding UTF8\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">## 서비스</span>\n<span class=\"token comment\">## stop에서 4:4:3 은 시스템 메시지 남기는 용도, 숫자의 의미는 크게 없음</span>\n<span class=\"token comment\">## Restart-Service로 대체</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$services</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sv</span> in <span class=\"token variable\">$services</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">sc</span><span class=\"token punctuation\">.</span>exe config <span class=\"token variable\">$sv</span><span class=\"token punctuation\">.</span>Name obj= <span class=\"token variable\">$id</span> password= <span class=\"token variable\">$pw</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sv</span><span class=\"token punctuation\">.</span>State <span class=\"token operator\">-eq</span> <span class=\"token string\">\"Running\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">#sc.exe stop $sv.Name 4:4:3</span>\n            <span class=\"token comment\">#sc.exe start $sv.Name</span>\n            <span class=\"token function\">Restart-Service</span> <span class=\"token variable\">$sv</span><span class=\"token punctuation\">.</span>Name\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">## 작업 스케줄러 > 한/영 구분하여 처리</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$schds</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sc</span> in <span class=\"token variable\">$schds</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sc</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"작업 이름\"</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            schtasks<span class=\"token punctuation\">.</span>exe <span class=\"token operator\">/</span>Change <span class=\"token operator\">/</span>TN <span class=\"token variable\">$sc</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"작업 이름\"</span> <span class=\"token operator\">/</span>RU <span class=\"token variable\">$id</span> <span class=\"token operator\">/</span><span class=\"token function\">RP</span> <span class=\"token variable\">$pw</span>\n        <span class=\"token punctuation\">}</span><span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$sc</span><span class=\"token punctuation\">.</span>TaskName <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            schtasks<span class=\"token punctuation\">.</span>exe <span class=\"token operator\">/</span>Change <span class=\"token operator\">/</span>TN <span class=\"token variable\">$sc</span><span class=\"token punctuation\">.</span>TaskName <span class=\"token operator\">/</span>RU <span class=\"token variable\">$id</span> <span class=\"token operator\">/</span><span class=\"token function\">RP</span> <span class=\"token variable\">$pw</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">## Application Pool</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pools</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pool</span> in <span class=\"token variable\">$pools</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$pool</span><span class=\"token punctuation\">.</span>processModel<span class=\"token punctuation\">.</span>userName = <span class=\"token variable\">$id</span>\n        <span class=\"token variable\">$pool</span><span class=\"token punctuation\">.</span>processModel<span class=\"token punctuation\">.</span>password = <span class=\"token variable\">$pw</span>\n        <span class=\"token variable\">$pool</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Set-Item</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">## from http://stackoverflow.com/questions/25215354/how-to-set-connectas-user-in-iis-using-powershell</span>\n<span class=\"token comment\">## Web Site</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sites</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$site</span> in <span class=\"token variable\">$sites</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$siteName</span> = <span class=\"token variable\">$site</span><span class=\"token punctuation\">.</span>Name\n        <span class=\"token variable\">$fullPath</span> = <span class=\"token string\">\"system.applicationHost/sites/site[@name='<span class=\"token variable\">$siteName</span>']/application[@path='/']/virtualDirectory[@path='/']\"</span>\n        <span class=\"token function\">Set</span><span class=\"token operator\">-</span>WebConfiguration <span class=\"token variable\">$fullPath</span> <span class=\"token operator\">-</span>Value @<span class=\"token punctuation\">{</span>username=<span class=\"token variable\">$id</span><span class=\"token punctuation\">;</span>password=<span class=\"token variable\">$pw</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">## Web Application</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$applications</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$app</span> in <span class=\"token variable\">$applications</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$xpath</span> = <span class=\"token variable\">$app</span><span class=\"token punctuation\">.</span>ItemXPath\n        <span class=\"token variable\">$fullPath</span> = <span class=\"token string\">\"<span class=\"token variable\">$xpath</span>/virtualDirectory[@path='/']\"</span>\n        <span class=\"token function\">Set</span><span class=\"token operator\">-</span>WebConfiguration <span class=\"token variable\">$fullPath</span> <span class=\"token operator\">-</span>Value @<span class=\"token punctuation\">{</span>username=<span class=\"token variable\">$id</span><span class=\"token punctuation\">;</span>password=<span class=\"token variable\">$pw</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">## Virtual Directory</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$virtualDirs</span> <span class=\"token operator\">-ne</span> <span class=\"token variable\">$NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$vdir</span> in <span class=\"token variable\">$virtualDirs</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$xpath</span> = <span class=\"token variable\">$vdir</span><span class=\"token punctuation\">.</span>ItemXPath\n        <span class=\"token variable\">$fullPath</span> = <span class=\"token variable\">$xpath</span><span class=\"token punctuation\">.</span>Substring<span class=\"token punctuation\">(</span>1<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">Set</span><span class=\"token operator\">-</span>WebConfiguration <span class=\"token variable\">$fullPath</span> <span class=\"token operator\">-</span>Value @<span class=\"token punctuation\">{</span>username=<span class=\"token variable\">$id</span><span class=\"token punctuation\">;</span>password=<span class=\"token variable\">$pw</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$end</span> = <span class=\"token function\">Read-Host</span> <span class=\"token string\">\"Please enter key for exit\"</span></code></pre></div>","fields":{"slug":"/posts/Change-admin-password-in-win2008r2/","tagSlugs":["/tag/windows-server/","/tag/iis/","/tag/config/"]},"frontmatter":{"date":"2019-03-18T00:00:00.000Z","description":"Windows Server 2008 R2에서 관리자 비밀번호 변경 이후 처리과정","tags":["Windows Server","IIS","Config"],"title":"Windows Server 2008 R2에서 관리자 비밀번호 변경 이후 처리","socialImage":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/Change-admin-password-in-win2008r2/"}}}