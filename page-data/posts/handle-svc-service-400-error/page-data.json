{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/handle-svc-service-400-error/","result":{"data":{"markdownRemark":{"id":"9b0e4792-cb85-521e-96b6-efc8b0107c4b","html":"<h1 id=\"svc-서비스-400-error\"><a href=\"#svc-%EC%84%9C%EB%B9%84%EC%8A%A4-400-error\" aria-label=\"svc 서비스 400 error permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>svc 서비스 400 error</h1>\n<p>svc 서비스에서 400 에러가 나서 그것에 대한 원인 찾는 과정</p>\n<p>.svc 를 가지고 서비스 참조에 추가해서 호출하는데 400 error가 나서 원인을 검색</p>\n<h2 id=\"요청-메시지-허용크기-초과\"><a href=\"#%EC%9A%94%EC%B2%AD-%EB%A9%94%EC%8B%9C%EC%A7%80-%ED%97%88%EC%9A%A9%ED%81%AC%EA%B8%B0-%EC%B4%88%EA%B3%BC\" aria-label=\"요청 메시지 허용크기 초과 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>요청 메시지 허용크기 초과</h2>\n<p>대부분 case가 요청 메시지의 용량 초과에 대한 case로 나타남\n이는  다음과 같이 MaxReceivedMessageSize 값 과 ReaderQuotas 값을 조정하여 해결할 수 있다</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"> <span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">CommonBoardService<span class=\"token punctuation\">.</span>CommonBoardServiceClient</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CommonBoardService<span class=\"token punctuation\">.</span>CommonBoardServiceClient</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">System<span class=\"token punctuation\">.</span>ServiceModel<span class=\"token punctuation\">.</span>WebHttpBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      MaxReceivedMessageSize <span class=\"token operator\">=</span> <span class=\"token number\">1024000000</span><span class=\"token punctuation\">,</span> \n      ReaderQuotas <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">System<span class=\"token punctuation\">.</span>Xml<span class=\"token punctuation\">.</span>XmlDictionaryReaderQuotas</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> MaxStringContentLength <span class=\"token operator\">=</span> <span class=\"token number\">2147483647</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EndpointAddress</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Uri</span><span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// BoadyStyle : Wrapped 로 설정</span>\n    client<span class=\"token punctuation\">.</span>Endpoint<span class=\"token punctuation\">.</span>Behaviors<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">WebHttpBehavior</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> DefaultBodyStyle <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span>ServiceModel<span class=\"token punctuation\">.</span>Web<span class=\"token punctuation\">.</span>WebMessageBodyStyle<span class=\"token punctuation\">.</span>Wrapped <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 여기서 호출</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"처리하지-못한-예외--svc-trace-log-설정\"><a href=\"#%EC%B2%98%EB%A6%AC%ED%95%98%EC%A7%80-%EB%AA%BB%ED%95%9C-%EC%98%88%EC%99%B8--svc-trace-log-%EC%84%A4%EC%A0%95\" aria-label=\"처리하지 못한 예외  svc trace log 설정 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>처리하지 못한 예외 (+ svc trace log 설정)</h2>\n<p>하지만 이걸로도 해결이 되지 않는 case가 있어서 로그를 남길 수 있는 설정에 대해서 검색\n현재는 오류가 나면 catch문에서 txt file에다가 에러로그를 쓰게끔 되어 있다. 이렇게 되면 에러를 처리했기 때문에 200ok 로 response 되지만, response data에 error내용과 코드를 심어서 전달</p>\n<p>하지만 400 error는 catch에서 처리하지 못한 case이기 때문에, 요청 전인지, 요청 처리하는 중인지 알 수 가 없었음.</p>\n<p>서버에서 svc에 대한 로그를 남기는 방법은 web.config에 아래 노드를 추가</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>system.diagnostics</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sources</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>System.ServiceModel<span class=\"token punctuation\">\"</span></span>\n                  <span class=\"token attr-name\">switchValue</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Information, ActivityTracing<span class=\"token punctuation\">\"</span></span>\n                  <span class=\"token attr-name\">propagateActivity</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>listeners</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>add</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>traceListener<span class=\"token punctuation\">\"</span></span>\n                     <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>System.Diagnostics.XmlWriterTraceListener<span class=\"token punctuation\">\"</span></span>\n                     <span class=\"token attr-name\">initializeData</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span> <span class=\"token punctuation\">\"</span>D:\\logs\\Traces.svclog<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>listeners</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>source</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sources</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>system.diagnostics</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>그렇게 하여 svc 요청을 보내 400error를 한번 받으면 아래와 같은 trace log가 파일로 남게 된다\n<code class=\"language-text\">&lt;E2ETraceEvent&gt;</code> 이 노드들이 있고 하위 <code class=\"language-text\">&lt;ApplicationData&gt;</code> 에 상세 내용이 들어 있음</p>\n<p>예외가 났고, 예외를 처리하지 않아 이렇게 되어 있는것을 확인. 확인결과 try-catch 밖에서 해당 예외가 발생한 것을 확인</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token comment\">&lt;!-- ... 앞부분 --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>E2ETraceEvent</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://schemas.microsoft.com/2004/06/E2ETraceEvent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>System</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://schemas.microsoft.com/2004/06/windows/eventlog/system<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>EventID</span><span class=\"token punctuation\">></span></span>131076<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>EventID</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Type</span><span class=\"token punctuation\">></span></span>3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Type</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>SubType</span> <span class=\"token attr-name\">Name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Information<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>SubType</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Level</span><span class=\"token punctuation\">></span></span>8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Level</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TimeCreated</span> <span class=\"token attr-name\">SystemTime</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>2017-07-10T05:03:12.0199902Z<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Source</span> <span class=\"token attr-name\">Name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>System.ServiceModel<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Correlation</span> <span class=\"token attr-name\">ActivityID</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{026e0c38-beda-4f68-8230-dae2eec97319}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Execution</span> <span class=\"token attr-name\">ProcessName</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>w3wp<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ProcessID</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>5276<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ThreadID</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>7<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Channel</span><span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Computer</span><span class=\"token punctuation\">></span></span>HOSTNAME<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Computer</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>System</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ApplicationData</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TraceData</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>DataItem</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TraceRecord</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>http://schemas.microsoft.com/2004/10/E2ETraceEvent/TraceRecord<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Severity</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Information<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TraceIdentifier</span><span class=\"token punctuation\">></span></span>http://msdn.microsoft.com/ko-KR/library/System.ServiceModel.Diagnostics.TraceHandledException.aspx<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>TraceIdentifier</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Description</span><span class=\"token punctuation\">></span></span>예외를 처리합니다.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Description</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>AppDomain</span><span class=\"token punctuation\">></span></span>/LM/W3SVC/2/ROOT-3-131441365890367230<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>AppDomain</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Exception</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ExceptionType</span><span class=\"token punctuation\">></span></span>System.Exception, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ExceptionType</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Message</span><span class=\"token punctuation\">></span></span>요청하신 게시판은 대상이 아닙니다.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Message</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>StackTrace</span><span class=\"token punctuation\">></span></span>{StackTrace}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>StackTrace</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ExceptionString</span><span class=\"token punctuation\">></span></span>System.Exception: 요청하신 게시판은 대상이 아닙니다. 위치: {StackTrace}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ExceptionString</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Exception</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>TraceRecord</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>DataItem</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>TraceData</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ApplicationData</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>E2ETraceEvent</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&lt;!-- 뒷부분 ... --></span></code></pre></div>","fields":{"slug":"/posts/handle-svc-service-400-error/","tagSlugs":["/tag/share-point/"]},"frontmatter":{"date":"2017-07-27T00:00:00.000Z","description":"SVC 서비스의 400 에러에 대한 대처","tags":["SharePoint"],"title":"svc 서비스 400 error 처리","socialImage":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/handle-svc-service-400-error/"}}}